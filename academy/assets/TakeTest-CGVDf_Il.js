import{j as e}from"./state-DF3Lb9FH.js";import{h as Ce,u as Me,c as Qe,b as o}from"./react-BdkzLz8Q.js";import{r as ue,a as he}from"./katex.min-BmzFcbEa.js";import{C as Ae}from"./circle-check-SlWgBxim.js";import{C as Le,L as R}from"./lightbulb-CA_H98Z7.js";import{B as Re,C as xe}from"./circle-alert-Dkw7RVA0.js";import{M as pe,r as Ie,a as qe}from"./markdown-CmISyzGm.js";import{c as v,e as L}from"./index-CTZpcPjK.js";import{C as Ee}from"./chevron-right-KFr7QArd.js";const Fe=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],He=v("bookmark",Fe);const Pe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Oe=v("chevron-left",Pe);const ze=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],Be=v("flag",ze);const Ue=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],De=v("rotate-ccw",Ue);const Ge=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],We=v("send",Ge);const Ke=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],Ye=v("timer",Ke),$=({content:c,className:n})=>{const i=(m=>{if(!m)return"";let r=m.replace(/\\\\/g,"\\").replace(/\\\$/g,"$");return r=r.replace(/\$/g,""),r=r.replace(/\\\s*([x/])/gi," $1"),r=r.replace(/(^|[^\\])frac\{/g,"$1\\frac{"),r=r.replace(/\\frac\s*([^{}\s]+)\}\{([^{}]+)\}/g,"\\frac{$1}{$2}"),r=r.replace(/(\d+(?:\.\d+)?)\s*\\?(times|div|pm)\s*(\d+(?:\.\d+)?)/gi,(u,a,h,p)=>`${a} \\${String(h).toLowerCase()} ${p}`),r=r.replace(/\\frac\{[^{}]+\}\{[^{}]+\}/g,u=>`$${u}$`),r=r.replace(/\\sqrt\{[^{}]+\}/g,u=>`$${u}$`),r=r.replace(/\\(?:pi|theta|alpha|beta|gamma|delta|sigma|pm|times|div)(?![a-zA-Z])/g,u=>`$${u}$`),r=r.replace(/\\times/g," x ").replace(/\\div/g," / ").replace(/\\pm/g,"+/-").replace(/\\cdot/g," * ").replace(/\\\(/g,"(").replace(/\\\)/g,")"),r})(c);return e.jsx("div",{className:n,children:e.jsx(pe,{remarkPlugins:[he],rehypePlugins:[[ue,{strict:!1,throwOnError:!1,output:"html"}]],components:{p:({node:m,...r})=>e.jsx("p",{className:"mb-2 last:mb-0",...r})},children:i})})},Je=({question:c,userAnswer:n,isCorrect:d,showHint:i=!1,onTryAgain:m,onShowHint:r})=>e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:`
                p-4 rounded-xl border-2 flex items-start gap-3
                ${d?"bg-green-50 border-green-200":"bg-orange-50 border-orange-200"}
            `,children:[d?e.jsx(Ae,{className:"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(Le,{className:"w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-bold text-base mb-1 ${d?"text-green-900":"text-orange-900"}`,children:d?"Excellent! You've got this concept.":"Not quite - let's understand why."}),e.jsx("p",{className:`text-sm ${d?"text-green-700":"text-orange-700"}`,children:d?"Your practice is paying off! Keep building mastery.":"This is a common challenge. Here's the key insight..."})]})]}),c.explanation_correct&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Re,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-bold text-blue-900 mb-2",children:["Why ",c.correct_answer," is correct:"]}),e.jsx($,{content:c.explanation_correct,className:"text-sm text-blue-800 prose prose-sm max-w-none"})]})]})}),!d&&c.explanation_wrong&&c.explanation_wrong[n]&&e.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-bold text-orange-900 mb-2",children:["Why ",n," is not correct:"]}),e.jsx($,{content:c.explanation_wrong[n],className:"text-sm text-orange-800 prose prose-sm max-w-none"})]})]})}),!d&&c.common_misconceptions&&c.common_misconceptions.length>0&&e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4",children:[e.jsxs("h5",{className:"font-bold text-yellow-900 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Common Mistakes to Avoid:"]}),e.jsx("ul",{className:"space-y-1 text-sm text-yellow-800",children:c.common_misconceptions.map((u,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-600 mt-0.5",children:"â€¢"}),e.jsx($,{content:u})]},a))})]}),c.worked_example&&e.jsxs("div",{className:"bg-slate-50 border-2 border-slate-200 rounded-xl p-4",children:[e.jsx("h5",{className:"font-bold text-slate-900 mb-2",children:"Step-by-Step Solution:"}),e.jsx("div",{className:"text-sm text-slate-800 font-mono bg-white p-3 rounded border border-slate-200 overflow-x-auto",children:e.jsx($,{content:c.worked_example})})]}),i&&c.hint&&e.jsx("div",{className:"bg-indigo-50 border-2 border-indigo-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-indigo-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-bold text-indigo-900 mb-2",children:"Hint:"}),e.jsx($,{content:c.hint,className:"text-sm text-indigo-800 prose prose-sm max-w-none"})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[!d&&m&&e.jsx("button",{onClick:m,className:"px-4 py-2 bg-orange-600 text-white rounded-lg font-semibold hover:bg-orange-700 transition-colors",children:"Try Again"}),!i&&c.hint&&r&&e.jsxs("button",{onClick:r,className:"px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg font-semibold hover:bg-indigo-200 transition-colors flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Show Hint"]})]})]}),Ve=c=>{if(!c)return"";let n=c.replace(/\\\\/g,"\\").replace(/\\\$/g,"$");return n=n.replace(/\$/g,""),n=n.replace(/\\\s*([x/])/gi," $1"),n=n.replace(/(^|[^\\])frac\{/g,"$1\\frac{"),n=n.replace(/\\frac\s*([^{}\s]+)\}\{([^{}]+)\}/g,"\\frac{$1}{$2}"),n=n.replace(/(\d+(?:\.\d+)?)\s*\\?(times|div|pm)\s*(\d+(?:\.\d+)?)/gi,(d,i,m,r)=>`${i} \\${String(m).toLowerCase()} ${r}`),n=n.replace(/\\frac\{[^{}]+\}\{[^{}]+\}/g,d=>`$${d}$`),n=n.replace(/\\sqrt\{[^{}]+\}/g,d=>`$${d}$`),n=n.replace(/\\(?:pi|theta|alpha|beta|gamma|delta|sigma|pm|times|div)(?![a-zA-Z])/g,d=>`$${d}$`),n=n.replace(/\\times/g," x ").replace(/\\div/g," / ").replace(/\\pm/g,"+/-").replace(/\\cdot/g," * ").replace(/\\\(/g,"(").replace(/\\\)/g,")"),n},ge=c=>{const n=String(c||"").replace(/\\\\/g,"\\").replace(/(^|[^\\])frac\{/g,"$1\\frac{").replace(/\\frac\s*([^{}\s]+)\}\{([^{}]+)\}/g,"\\frac{$1}{$2}").replace(/\\times/g," x ").replace(/\\div/g," / ").replace(/\\pm/g,"+/-").replace(/\\cdot/g," * ").replace(/\\\(/g,"(").replace(/\\\)/g,")"),d=/\\frac\{([^{}]+)\}\{([^{}]+)\}/g,i=[];let m=0,r,u=0;for(;(r=d.exec(n))!==null;){r.index>m&&i.push(n.slice(m,r.index));const a=r[1],h=r[2];i.push(e.jsxs("span",{className:"inline-flex flex-col items-center align-middle mx-1 leading-none",children:[e.jsx("span",{className:"px-0.5",children:a}),e.jsx("span",{className:"w-full border-t border-current my-0.5"}),e.jsx("span",{className:"px-0.5",children:h})]},`frac-${u++}`)),m=d.lastIndex}return m<n.length&&i.push(n.slice(m)),i.length?i:[n]},Ze=[Ie,qe,he],Xe=o.memo(function({questionsLength:n,answers:d,markedForReview:i,currentQuestionIndex:m,onGoToQuestion:r}){return e.jsx("div",{className:"grid grid-cols-6 sm:grid-cols-10 gap-2",children:Array.from({length:n}).map((u,a)=>{const h=(d[a]||"").trim().length>0,p=i.has(a),y=a===m;let b="border-slate-200 bg-white text-slate-600";return h&&(b="border-emerald-200 bg-emerald-50 text-emerald-700"),p&&(b="border-amber-200 bg-amber-50 text-amber-700"),y&&(b="border-indigo-600 bg-indigo-600 text-white"),e.jsx("button",{type:"button",onClick:()=>r(a),className:`h-10 rounded-xl border font-black text-sm transition-all hover:scale-[1.03] ${b}`,children:a+1},a)})})}),et=o.memo(function({options:n,userAnswer:d,isAnswered:i,practiceMode:m,isCorrect:r,onAnswerChange:u}){return e.jsx("div",{className:"grid grid-cols-1 gap-4",children:Object.entries(n||{}).map(([a,h])=>e.jsxs("button",{onClick:()=>u(a),disabled:i&&m,className:`flex items-start gap-5 p-6 rounded-2xl border-2 transition-all text-left group ${d===a?m?r?"border-emerald-500 bg-emerald-50 dark:border-emerald-400 dark:bg-emerald-900/30":"border-rose-500 bg-rose-50 dark:border-rose-400 dark:bg-rose-900/30":"border-indigo-600 bg-indigo-50 shadow-md dark:border-indigo-400 dark:bg-indigo-900/35":"border-slate-50 bg-slate-50 hover:border-slate-200 hover:bg-white dark:border-slate-700 dark:bg-slate-800 dark:hover:border-slate-600 dark:hover:bg-slate-800/80"}`,children:[e.jsx("div",{className:`w-9 h-9 rounded-xl flex items-center justify-center font-black flex-shrink-0 transition-transform group-hover:scale-105 ${d===a?"bg-indigo-600 text-white":"bg-white text-slate-400 border border-slate-200 shadow-sm"}`,children:a}),e.jsx("span",{className:`flex-1 font-bold text-lg leading-snug pt-1 ${d===a?"text-slate-900 dark:text-slate-100":"text-slate-600 dark:text-slate-200"}`,children:ge(String(h||""))})]},a))})}),dt=()=>{const{testId:c}=Ce(),n=Me(),d=Qe(),i=d.state?.practiceMode||!1,m=d.state?.examTrack||null,[r,u]=o.useState(null),[a,h]=o.useState(0),[p,y]=o.useState({}),[b,D]=o.useState(new Set),[be,fe]=o.useState(!0),[G,W]=o.useState(""),[K,Y]=o.useState(!1),[j,I]=o.useState(900),[w,q]=o.useState(new Set),[k,_]=o.useState(!1),[E,J]=o.useState({}),[F,H]=o.useState(new Set),[we,je]=o.useState(new Map),[V,Z]=o.useState(!1),[T,C]=o.useState(""),[X,ee]=o.useState(""),[te,P]=o.useState(""),[O,se]=o.useState(!1),[ae,M]=o.useState(""),z=o.useRef(Date.now()),[re,Ne]=o.useState(!1),ne=o.useRef(!1),N=o.useRef(null),f=o.useMemo(()=>c?`take-test-progress-v1-${c}`:"",[c]),ve=[{value:"unclear_wording",label:"Unclear wording"},{value:"wrong_answer",label:"Wrong answer"},{value:"too_hard",label:"Too hard"},{value:"off_topic",label:"Off topic"}];o.useEffect(()=>{if(f)try{const t=sessionStorage.getItem(f);if(!t)return;const s=JSON.parse(t);s&&typeof s=="object"&&(s.answers&&typeof s.answers=="object"&&y(s.answers),Number.isInteger(s.currentQuestionIndex)&&Number(s.currentQuestionIndex)>=0&&h(Number(s.currentQuestionIndex)),Array.isArray(s.markedForReview)&&D(new Set(s.markedForReview.map(l=>Number(l)).filter(l=>Number.isInteger(l)&&l>=0))),Array.isArray(s.showHintsByQuestion)&&q(new Set(s.showHintsByQuestion.map(l=>Number(l)).filter(l=>Number.isInteger(l)&&l>=0))),s.questionTimes&&typeof s.questionTimes=="object"&&J(s.questionTimes),Array.isArray(s.hintsUsed)&&H(new Set(s.hintsUsed.map(l=>Number(l)).filter(l=>Number.isInteger(l)&&l>=0))),Number.isFinite(s.timeLeft)&&Number(s.timeLeft)>0&&(I(Number(s.timeLeft)),ne.current=!0))}catch{sessionStorage.removeItem(f)}finally{Ne(!0)}},[f]),o.useEffect(()=>{(async()=>{try{const s=await L.get(`/tests/${c}`);u(s.data),W("");const l=90,S=s.data?.questions?.length||s.data?.question_count||10;ne.current||I(S*l)}catch(s){console.error("Failed to fetch test",s);const l=s?.response?.data?.detail;W(typeof l=="string"&&l.trim()?l:"Failed to load test. Please try again.")}finally{fe(!1)}})()},[c]),o.useEffect(()=>{if(j<=0||i)return;const t=setInterval(()=>{I(s=>s-1)},1e3);return()=>clearInterval(t)},[j,i]),o.useEffect(()=>{if(!(!re||!f))return N.current&&window.clearTimeout(N.current),N.current=window.setTimeout(()=>{try{sessionStorage.setItem(f,JSON.stringify({answers:p,currentQuestionIndex:a,markedForReview:Array.from(b),showHintsByQuestion:Array.from(w),questionTimes:E,hintsUsed:Array.from(F),timeLeft:j,updatedAt:Date.now()}))}catch{}},250),()=>{N.current&&(window.clearTimeout(N.current),N.current=null)}},[re,f,p,a,b,w,E,F,j]);const g=r?.questions||[],x=g[a],B=o.useMemo(()=>{const t=String(r?.standard_focus||"").trim();if(t)return t;const s=String(x?.learning_objective||"").trim();return s||String(r?.subject||"Current topic").trim()},[r?.standard_focus,r?.subject,x?.learning_objective]);o.useEffect(()=>{g.length&&a>g.length-1&&h(Math.max(0,g.length-1))},[g.length,a]),o.useEffect(()=>{i&&(T.trim()||C(B))},[i,T,B]);const oe=o.useMemo(()=>Object.values(p).filter(t=>typeof t=="string"&&t.trim().length>0).length,[p]),U=Math.max(0,g.length-oe),le=o.useCallback(t=>{const s=x?.question_type==="mcq"||!!x?.options;k&&i&&s||(y(l=>({...l,[a]:t})),i&&t.trim().length>0&&_(!0))},[x,a,k,i]),ie=t=>{const s=Math.round((Date.now()-z.current)/1e3);J(l=>({...l,[t]:(l[t]||0)+s})),z.current=Date.now()},ye=async t=>{if(Z(!1),!!x?.id)try{await L.post(`/tests/${c}/questions/${x.id}/flag`,{reason:t}),je(s=>new Map(s).set(a,t))}catch{}},ke=()=>{D(t=>{const s=new Set(t);return s.has(a)?s.delete(a):s.add(a),s})},ce=()=>{y(t=>{const s={...t};return delete s[a],s}),_(!1)},Se=()=>{ie(a),h(t=>Math.min(t+1,g.length-1)),_(!1)},$e=o.useCallback(t=>{ie(a),h(t),_(!1)},[a]),_e=async()=>{if(g.length===0||U>0&&!window.confirm(`You still have ${U} unanswered question(s) and ${b.size} marked for review. Submit anyway?`))return;Y(!0);const t={...E},s=Math.round((Date.now()-z.current)/1e3);t[a]=(t[a]||0)+s;try{const l=await L.post(`/tests/${c}/submit`,p);f&&sessionStorage.removeItem(f),n(`/results/${c}`,{state:{answers:p,ai_feedback:l.data.ai_feedback,submission:l.data,practiceMode:i,examTrack:m,questionTimes:t,hintsUsed:Array.from(F)}})}catch(l){console.error("Submission failed",l)}finally{Y(!1)}},de=async t=>{const s=String(t||T).trim();if(s.length<2){M("Enter a topic for the tutor.");return}se(!0),M(""),P("");try{const l=await L.post("/learning/tutor",{topic:s,grade_level:Number(r?.grade_level)||void 0,subject:String(r?.subject||"").toLowerCase()||void 0,exam_standard:String(m||r?.exam_standard||"").toLowerCase()||void 0,learner_note:X.trim()||void 0});P(String(l.data?.lesson||"No tutor content returned."))}catch(l){const S=l?.response?.data?.detail;M(typeof S=="string"&&S.trim()?S:"Tutor request failed.")}finally{se(!1)}};if(be)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white/95 border border-slate-200 rounded-2xl p-6 shadow-lg flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-slate-800 font-semibold",children:"Loading test..."})]})});if(G)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-xl w-full bg-white border border-rose-200 rounded-2xl p-6 shadow-lg",children:[e.jsx("p",{className:"text-sm font-black uppercase tracking-widest text-rose-600",children:"Could not load test"}),e.jsx("p",{className:"mt-2 text-slate-800",children:G})]})});if(!r)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-xl w-full bg-white border border-slate-200 rounded-2xl p-6 shadow-lg",children:[e.jsx("p",{className:"text-sm font-black uppercase tracking-widest text-slate-500",children:"Test unavailable"}),e.jsx("p",{className:"mt-2 text-slate-800",children:"Test not found."})]})});if(!x)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-xl w-full bg-white border border-slate-200 rounded-2xl p-6 shadow-lg",children:[e.jsx("p",{className:"text-sm font-black uppercase tracking-widest text-slate-500",children:"Question unavailable"}),e.jsx("p",{className:"mt-2 text-slate-800",children:"Question not found."})]})});const Te=a===g.length-1,Q=x.question_type==="mcq"||!!x.options,A=p[a]||"",me=Q&&A===x.correct_answer;return e.jsx("div",{className:`${i?"max-w-7xl":"max-w-5xl"} mx-auto py-4`,children:e.jsxs("div",{className:i?"grid grid-cols-1 xl:grid-cols-[minmax(0,1fr)_360px] gap-6":"",children:[e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom duration-400",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-black text-slate-900 tracking-tight",children:r.title}),i&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-50 text-emerald-600 border border-emerald-100 rounded text-[10px] font-black uppercase tracking-widest",children:"Practice Mode"})]}),e.jsxs("p",{className:"text-slate-500 font-medium",children:["Question ",a+1," of ",g.length]})]}),!i&&e.jsxs("div",{className:"flex items-center gap-3 bg-white px-4 py-2 rounded-2xl border border-slate-200 shadow-sm",children:[e.jsx(Ye,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("span",{className:"text-lg font-black font-mono text-slate-900 tracking-tighter",children:[Math.floor(j/60),":",(j%60).toString().padStart(2,"0")]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[e.jsx("p",{className:"font-bold text-slate-900",children:"Question Palette"}),e.jsxs("div",{className:"text-xs font-semibold text-slate-500",children:["Answered: ",e.jsx("span",{className:"text-emerald-600",children:oe})," | Remaining: ",e.jsx("span",{className:"text-rose-600",children:U})," | Review: ",e.jsx("span",{className:"text-amber-600",children:b.size})]})]}),e.jsx(Xe,{questionsLength:g.length,answers:p,markedForReview:b,currentQuestionIndex:a,onGoToQuestion:$e})]}),e.jsx("div",{className:"h-2 w-full bg-slate-100 rounded-full overflow-hidden shadow-inner",children:e.jsx("div",{className:"h-full bg-indigo-600 transition-all duration-700 ease-out shadow-sm",style:{width:`${(a+1)/g.length*100}%`}})}),e.jsxs("div",{className:"bg-white p-8 sm:p-12 rounded-[2rem] border border-slate-200 shadow-xl shadow-slate-100/50 space-y-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1.5 bg-indigo-600/10"}),e.jsxs("div",{className:"absolute top-6 right-6 flex items-center gap-2",children:[e.jsx("button",{onClick:ke,className:`p-3 rounded-2xl border transition-all ${b.has(a)?"bg-amber-50 text-amber-700 border-amber-200":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,title:"Mark for review",children:e.jsx(He,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>Z(!V),className:`p-3 rounded-2xl border transition-all ${we.has(a)?"bg-rose-50 text-rose-600 border-rose-200":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}`,title:"Flag this question",children:e.jsx(Be,{className:"w-5 h-5"})}),V&&e.jsxs("div",{className:"absolute right-0 top-12 z-50 bg-white border border-slate-200 rounded-2xl shadow-xl p-2 min-w-[180px]",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest px-3 py-1",children:"Why flag?"}),ve.map(t=>e.jsx("button",{onClick:()=>ye(t.value),className:"w-full text-left px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 rounded-xl transition-colors",children:t.label},t.value))]})]}),e.jsx("button",{onClick:()=>{const t=new Set(w);t.has(a)?t.delete(a):(t.add(a),H(s=>new Set(s).add(a))),q(t)},className:`p-3 rounded-2xl transition-all border ${w.has(a)?"bg-amber-100 text-amber-700 border-amber-300 shadow-md":"bg-amber-50 text-amber-600 hover:bg-amber-100 border-amber-100 shadow-sm"}`,title:"Get a hint",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("button",{onClick:ce,className:"p-3 rounded-2xl bg-slate-50 text-slate-600 hover:bg-slate-100 transition-all border border-slate-100 shadow-sm",title:"Clear answer",children:e.jsx(De,{className:"w-5 h-5"})})]}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-slate-900 leading-[1.3] tracking-tight pr-24",children:ge(String(x.question_text||""))}),w.has(a)&&x.hint&&e.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-400 p-5 rounded-2xl animate-in fade-in zoom-in duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(R,{className:"w-4 h-4 text-amber-600"}),e.jsx("span",{className:"text-xs font-black text-amber-700 uppercase",children:"Hint"})]}),e.jsx("p",{className:"text-sm text-slate-700 font-medium italic leading-relaxed",children:x.hint})]}),Q?e.jsx(et,{options:x.options||{},userAnswer:A,isAnswered:k,practiceMode:i,isCorrect:!!me,onAnswerChange:le}):e.jsx("textarea",{value:A,onChange:t=>le(t.target.value),placeholder:"Type your detailed response here...",className:"w-full bg-slate-50 border-2 border-slate-100 rounded-3xl p-8 h-48 outline-none focus:ring-4 focus:ring-indigo-100 focus:border-indigo-600 transition-all font-medium text-lg text-slate-900 placeholder-slate-400"}),i&&k&&Q&&e.jsx(Je,{question:x,userAnswer:A,isCorrect:me,showHint:w.has(a),onShowHint:()=>{const t=new Set(w);t.add(a),q(t),H(s=>new Set(s).add(a))},onTryAgain:ce}),i&&k&&!Q&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-100 rounded-2xl p-6 space-y-3",children:[e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-indigo-700",children:"Model Guidance"}),e.jsx("p",{className:"text-slate-700 text-sm leading-relaxed",children:x.correct_answer||"Review the standard and provide a complete evidence-based response."}),x.explanation_correct&&e.jsx("p",{className:"text-slate-600 text-sm leading-relaxed",children:x.explanation_correct})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 py-4",children:[e.jsxs("button",{onClick:()=>h(t=>Math.max(t-1,0)),disabled:a===0,className:"w-full sm:w-auto px-8 py-4 rounded-2xl bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 disabled:opacity-30 font-bold flex items-center justify-center gap-2 transition-all",children:[e.jsx(Oe,{className:"w-5 h-5"})," Previous"]}),Te?e.jsxs("button",{onClick:_e,disabled:K,className:"w-full sm:w-auto px-10 py-4 rounded-2xl bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50 font-black shadow-xl shadow-indigo-100 flex items-center justify-center gap-3 transition-all hover:scale-[1.02] active:scale-95 text-lg",children:[K?"Submitting Responses...":"Finish Assessment",e.jsx(We,{className:"w-5 h-5"})]}):e.jsxs("button",{onClick:Se,className:"w-full sm:w-auto px-12 py-4 rounded-2xl bg-indigo-600 text-white hover:bg-indigo-700 font-black shadow-xl shadow-indigo-100 flex items-center justify-center gap-3 transition-all hover:scale-[1.02] active:scale-95 text-lg",children:["Next Question ",e.jsx(Ee,{className:"w-5 h-5"})]})]})]}),i&&e.jsxs("aside",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm p-5 space-y-4 h-fit xl:sticky xl:top-20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-slate-700",children:"Practice Tutor"}),e.jsx("button",{type:"button",onClick:()=>{C(B),ee(""),P(""),M("")},className:"text-xs text-slate-500 hover:text-slate-700",children:"Reset"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500",children:"Topic"}),e.jsx("input",{value:T,onChange:t=>C(t.target.value),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-900",placeholder:"Ask about this skill..."}),e.jsx("button",{type:"button",onClick:()=>C(String(x?.question_text||"").trim()),className:"text-xs text-indigo-600 hover:text-indigo-700 font-semibold",children:"Use current question text"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500",children:"What are you stuck on? (optional)"}),e.jsx("textarea",{value:X,onChange:t=>ee(t.target.value),rows:3,className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2 text-sm text-slate-900",placeholder:"Example: I confuse perimeter and area."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{de()},disabled:O,className:"flex-1 px-3 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold disabled:opacity-60",children:O?"Teaching...":"Teach Topic"}),e.jsx("button",{type:"button",onClick:()=>{de(String(x?.question_text||"").trim())},disabled:O,className:"flex-1 px-3 py-2 rounded-xl bg-slate-900 hover:bg-black text-white text-sm font-bold disabled:opacity-60",children:"Explain Q"})]}),ae&&e.jsx("p",{className:"text-xs text-rose-600 font-medium",children:ae}),te&&e.jsx("div",{className:"max-h-[60vh] overflow-auto border border-slate-200 rounded-xl p-3 bg-slate-50",children:e.jsx("div",{className:"prose prose-sm max-w-none whitespace-pre-wrap",children:e.jsx(pe,{remarkPlugins:Ze,rehypePlugins:[[ue,{strict:!1,throwOnError:!1,output:"html"}]],components:{p:({children:t})=>e.jsx("p",{className:"whitespace-pre-wrap",children:t}),li:({children:t})=>e.jsx("li",{className:"whitespace-pre-wrap",children:t})},children:Ve(te)})})})]})]})})};export{dt as default};
